<div class="gateway-channel-mapping">
  <div class="header">
    <h2>Gateway-Channel Mapping</h2>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="toggleCreateForm()" [disabled]="loading">
        <i class="fas fa-plus"></i> Create Mapping
      </button>
    </div>
  </div>

  <!-- Create Mapping Form -->
  <div class="create-form-card" *ngIf="showCreateForm">
    <div class="form-header">
      <h3>Create New Mapping</h3>
      <button class="btn btn-secondary btn-sm" (click)="toggleCreateForm()">Cancel</button>
    </div>
    
    <form (ngSubmit)="onCreateMapping()" class="mapping-form">
      <div class="form-row">
        <div class="form-group">
          <label for="gatewayUid">Payment Gateway *</label>
          <select id="gatewayUid" [(ngModel)]="newMapping.gatewayUid" name="gatewayUid" class="form-control" required>
            <option value="">Select Payment Gateway</option>
            <option *ngFor="let gateway of paymentGateways" [value]="gateway.uid">
              {{ gateway.name }} ({{ gateway.code }})
            </option>
          </select>
        </div>

        <div class="form-group">
          <label for="channelUid">Payment Channel *</label>
          <select id="channelUid" [(ngModel)]="newMapping.channelUid" name="channelUid" class="form-control" required>
            <option value="">Select Payment Channel</option>
            <option *ngFor="let channel of paymentChannels" [value]="channel.uid">
              {{ channel.name }} ({{ channel.code }})
            </option>
          </select>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="payCode">Pay Code *</label>
          <input 
            type="text" 
            id="payCode" 
            [(ngModel)]="newMapping.payCode" 
            name="payCode" 
            class="form-control"
            placeholder="e.g., AZAM-AZAMPESA11"
            required
          >
        </div>

        <div class="form-group">
          <label for="provider">Provider *</label>
          <input 
            type="text" 
            id="provider" 
            [(ngModel)]="newMapping.provider" 
            name="provider" 
            class="form-control"
            placeholder="e.g., Azampesa11"
            required
          >
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="loading">
          <i class="fas fa-save"></i> Create Mapping
        </button>
        <button type="button" class="btn btn-secondary" (click)="toggleCreateForm()">
          Cancel
        </button>
      </div>
    </form>
  </div>

  <!-- Filters -->
  <div class="filters-card">
    <div class="filters-header">
      <h3>Filters</h3>
      <button class="btn btn-secondary btn-sm" (click)="clearFilters()">Clear All</button>
    </div>
    
    <div class="filters-grid">
      <div class="filter-group">
        <label for="search">Search</label>
        <input 
          type="text" 
          id="search" 
          [(ngModel)]="filterForm.search" 
          placeholder="Search by gateway, channel, pay code..."
          class="form-control"
        >
      </div>

      <div class="filter-group">
        <label for="gatewayFilter">Payment Gateway</label>
        <select id="gatewayFilter" [(ngModel)]="filterForm.gatewayId" class="form-control">
          <option value="">All Gateways</option>
          <option *ngFor="let gateway of paymentGateways" [value]="gateway.uid">
            {{ gateway.name }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="channelFilter">Payment Channel</label>
        <select id="channelFilter" [(ngModel)]="filterForm.channelId" class="form-control">
          <option value="">All Channels</option>
          <option *ngFor="let channel of paymentChannels" [value]="channel.uid">
            {{ channel.name }}
          </option>
        </select>
      </div>

      <div class="filter-group">
        <label for="statusFilter">Status</label>
        <select id="statusFilter" [(ngModel)]="filterForm.active" class="form-control">
          <option value="">All Status</option>
          <option value="true">Active</option>
          <option value="false">Inactive</option>
        </select>
      </div>
    </div>

    <div class="filters-actions">
      <button class="btn btn-primary" (click)="applyFilters()" [disabled]="loading">
        <i class="fas fa-search"></i> Apply Filters
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading mappings...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-state">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      {{ error }}
    </div>
    <button class="btn btn-primary" (click)="loadMappings()">Retry</button>
  </div>

  <!-- Mappings Table -->
  <div *ngIf="!loading && !error" class="mappings-table-container">
    <div class="table-header">
      <h3>Gateway-Channel Mappings ({{ totalElements }} total)</h3>
    </div>

    <div class="table-responsive">
      <table class="mappings-table">
        <thead>
          <tr>
            <th>Gateway</th>
            <th>Channel</th>
            <th>Pay Code</th>
            <th>Provider</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let mapping of mappings" class="mapping-row">
            <td class="gateway-info">
              <div class="gateway-name">{{ mapping.paymentGatewayName }}</div>
              <div class="gateway-code">{{ mapping.paymentGatewayCode }}</div>
            </td>
            <td class="channel-info">
              <div class="channel-name">{{ mapping.paymentChannelName }}</div>
              <div class="channel-code">{{ mapping.paymentChannelCode }}</div>
            </td>
            <td class="pay-code">
              <code>{{ mapping.payCode }}</code>
            </td>
            <td class="provider">
              {{ mapping.provider }}
            </td>
            <td class="status">
              <span class="status-badge" [ngClass]="getStatusClass(mapping.active)">
                {{ mapping.active ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td class="created-date">
              {{ formatDate(mapping.createdAt) }}
            </td>
            <td class="actions">
              <div class="action-buttons">
                <button 
                  class="btn btn-sm btn-outline-primary" 
                  (click)="viewMappingDetails(mapping)"
                  title="View Details"
                >
                  <i class="fas fa-eye"></i>
                </button>
                <button 
                  *ngIf="!mapping.active"
                  class="btn btn-sm btn-outline-success" 
                  (click)="onActivateMapping(mapping)"
                  title="Activate"
                >
                  <i class="fas fa-check"></i>
                </button>
                <button 
                  *ngIf="mapping.active"
                  class="btn btn-sm btn-outline-warning" 
                  (click)="onDeactivateMapping(mapping)"
                  title="Deactivate"
                >
                  <i class="fas fa-pause"></i>
                </button>
                <button 
                  class="btn btn-sm btn-outline-danger" 
                  (click)="onDeleteMapping(mapping)"
                  title="Delete"
                >
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && mappings.length === 0" class="empty-state">
    <div class="empty-icon">
      <i class="fas fa-link"></i>
    </div>
    <h3>No mappings found</h3>
    <p *ngIf="!filterForm.gatewayId">Please select a payment gateway to view its mappings.</p>
    <p *ngIf="filterForm.gatewayId">No mappings found for the selected gateway. Create your first gateway-channel mapping to get started.</p>
    <button class="btn btn-primary" (click)="toggleCreateForm()">Create Mapping</button>
  </div>
</div>
